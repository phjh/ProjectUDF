using UnityEngine;
using TMPro;
using UnityEngine.UI;

public class MonoOre : MonoBehaviour
{
	[Header("UI Components")]
	public TMP_Text NameText;
	public TMP_Text DescText;
	public Image OreImage;
	public Button LinkedBtn;

	[Header("SO Values")]
	public OreSO[] OreDatas;
	public OreSO CardOreSO;

	public void GetOre() => OreInventory.Instance.AddOre(CardOreSO.stats, CardOreSO.value);

	private void OnEnable()
	{
		SetRandomOre();
		Debug.Log($"Random Ore Setting Complete : {CardOreSO}");
	}

	#region 외부 호출용 함수들
	private int tempSO = 0;
	private void SetRandomOre()
	{
		tempSO = Random.Range(0, OreDatas.Length);
		SetData();
	}

	public void ResetOre()
	{
		float successRate = Random.value;
		if( successRate <= 0.3f) //추후 재채광 성공 확률로 치환 예정
		{
			int resetTempSO = Random.Range(0, OreDatas.Length);
			while (resetTempSO == tempSO)
			{
				resetTempSO = Random.Range(0, OreDatas.Length);
			}
			tempSO = resetTempSO;
			SetData();
		}
		else
		{
			OreImage.color = new Vector4(1, 1, 1, 0);
			NameText.text = string.Empty;
			DescText.text = "재 채광에 실패해버렸다...";
			LinkedBtn.interactable = false;
		}
	}

	public void SetData()
	{
		CardOreSO = OreDatas[tempSO];
		#region 설명 문자열 단행 추가
		string desc = CardOreSO.OreDesc;
		desc = desc.Replace(",", "\n");
		#endregion
		NameText.text = CardOreSO.OreName;
		DescText.text = desc;
	}

	#endregion
}
